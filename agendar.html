<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Agendar cita</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
      text-align: center;
    }
    h1 {
      margin-bottom: 10px;
    }
    #fechaVisual {
      font-weight: bold;
      margin-bottom: 25px;
    }
    .hora {
      display: inline-block;
      margin: 10px;
      padding: 15px;
      border-radius: 10px;
      color: white;
      cursor: pointer;
    }
    .disponible {
      background: #28a745;
    }
    .ocupado {
      background: gray;
      pointer-events: none;
    }
    #idiomaSelect {
      position: absolute;
      top: 20px;
      right: 20px;
    }
  </style>
</head>
<body>

  <select id="idiomaSelect">
    <option value="es">Español</option>
    <option value="en">English</option>
  </select>

  <h1 id="titulo">Selecciona un horario</h1>
  <p id="fechaVisual"></p>

  <div id="horarios"></div>

  <script>
    const idiomaActual = localStorage.getItem("idioma") || "es";
    document.getElementById("idiomaSelect").value = idiomaActual;

    const textos = {
      es: { titulo: "Selecciona un horario", fechaLabel: "Citas disponibles para el: " },
      en: { titulo: "Select a Time Slot", fechaLabel: "Available appointments for: " }
    };

    function aplicarIdioma() {
      const t = textos[document.getElementById("idiomaSelect").value];
      document.getElementById("titulo").textContent = t.titulo;
    }

    document.getElementById("idiomaSelect").addEventListener("change", function () {
      localStorage.setItem("idioma", this.value);
      location.reload();
    });

    aplicarIdioma();

    // Generar horarios de 10am a 5pm
    const horarios = [];
    for (let i = 10; i <= 17; i++) {
      horarios.push(`${i}:00`);
    }

    // Calcular fecha 3 días después del actual
    const hoy = new Date();
    const fechaBase = new Date(hoy.getFullYear(), hoy.getMonth(), hoy.getDate() + 3);
    const fechaStr = fechaBase.toISOString().slice(0, 10);

    // Mostrar fecha visible
    const opcionesFecha = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    const fechaLegible = fechaBase.toLocaleDateString(idiomaActual === 'en' ? 'en-US' : 'es-MX', opcionesFecha);
    document.getElementById("fechaVisual").textContent =
      (idiomaActual === 'en' ? textos.en.fechaLabel : textos.es.fechaLabel) + fechaLegible;

    // Verificar horarios ocupados
    const citasAgendadas = JSON.parse(localStorage.getItem("citasAgendadas") || "[]");
    const ocupadasHoy = citasAgendadas
      .filter(c => c.fecha === fechaStr)
      .map(c => c.hora);

    const div = document.getElementById("horarios");

    horarios.forEach(hora => {
      const btn = document.createElement("div");
      btn.classList.add("hora");
      btn.textContent = hora;

      if (ocupadasHoy.includes(hora)) {
        btn.classList.add("ocupado");
      } else {
        btn.classList.add("disponible");
        btn.onclick = () => {
          localStorage.setItem("citaSeleccionada", JSON.stringify({ fecha: fechaStr, hora }));
          window.location.href = "registro.html";
        };
      }

      div.appendChild(btn);
    });
  </script>
</body>
</html>
