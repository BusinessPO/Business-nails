<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Registro de cita</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      text-align: center;
      background: #f0f0f0;
    }
    .contenedor {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      display: inline-block;
    }
    input, select {
      margin: 10px 0;
      padding: 10px;
      width: 250px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .boton {
      margin-top: 15px;
      padding: 12px 30px;
      font-size: 16px;
      border: none;
      background-color: #ff69b4;
      color: white;
      border-radius: 8px;
      cursor: pointer;
    }
    .boton:hover {
      background-color: #ff1493;
    }
  </style>
</head>
<body>

<div class="contenedor">
  <h2>¬øConfirmar cita?</h2>
  <p id="infoCita"></p>
  <p><strong>IMPORTANTE: Tu cita se registrar√° solo si al presionar el bot√≥n de confirmar env√≠as el WhatsApp predeterminado, si no lo env√≠as no se te podr√° atender.</strong></p>
  <p>En caso de querer cancelar tu cita, podr√°s hacerlo desde la p√°gina de inicio con al menos 2 d√≠as de anticipaci√≥n. Gracias</p>

  <form id="formRegistro">
    <input type="text" id="nombre" placeholder="Nombre" required /><br>
    <input type="text" id="apellido" placeholder="Apellido" required /><br>
    <select id="pago" required>
      <option value="">M√©todo de pago</option>
      <option>Efectivo</option>
      <option>Transferencia</option>
      <option>Otro</option>
    </select><br>
    <button type="submit" class="boton">Confirmar cita</button>
  </form>
</div>

<script>
  const cita = JSON.parse(localStorage.getItem("citaSeleccionada"));
  const info = document.getElementById("infoCita");

  if (!cita) {
    info.textContent = "No se ha seleccionado ninguna cita.";
    document.getElementById("formRegistro").style.display = "none";
  } else {
    info.textContent = `Fecha: ${cita.fecha} | Hora: ${cita.hora}`;
  }

  document.getElementById("formRegistro").addEventListener("submit", function(e) {
    e.preventDefault();

    const nombre = document.getElementById("nombre").value.trim();
    const apellido = document.getElementById("apellido").value.trim();
    const pago = document.getElementById("pago").value;

    if (!cita) return;

    const nuevaCita = {
      nombre,
      apellido,
      fecha: cita.fecha,
      hora: cita.hora,
      metodoPago: pago
    };

    let citas = JSON.parse(localStorage.getItem("citasConfirmadas") || "[]");
    citas.push(nuevaCita);
    localStorage.setItem("citasConfirmadas", JSON.stringify(citas));
    localStorage.removeItem("citaSeleccionada");

    // Guardar nombre para agradecimiento
    localStorage.setItem("nombreCliente", nombre);

    // Enviar mensaje de WhatsApp
    const mensaje = `üìÖ NUEVA CITA CONFIRMADA\nNombre: ${nombre} ${apellido}\nFecha: ${cita.fecha}\nHora: ${cita.hora}\nPago: ${pago}`;
    const numeroWhatsApp = "523338093018"; // ‚Üê CAMBIA ESTE N√öMERO
    const urlWhatsApp = `https://wa.me/${numeroWhatsApp}?text=${encodeURIComponent(mensaje)}`;
    
    window.open(urlWhatsApp, "_blank");

    // Redirigir despu√©s de unos segundos
    setTimeout(() => {
      window.location.href = "agradecimiento.html";
    }, 1000);
  });
</script>

</body>
</html>
