<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Agendar cita - T칤tulo</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #fff0f5;
      padding: 20px;
      text-align: center;
    }
    h1 {
      color: #d36ba0;
      margin-bottom: 10px;
    }
    #infoDiseno {
      font-size: 18px;
      margin-bottom: 20px;
      color: #444;
    }
    select, button {
      font-size: 16px;
      padding: 10px;
      margin: 10px auto;
      border-radius: 10px;
      border: 1px solid #ccc;
      width: 80%;
      max-width: 300px;
      display: block;
    }
    select#hora option {
      color: green;
    }
    select#hora option:disabled {
      color: gray;
      background-color: #eee;
    }
    button {
      background-color: #d36ba0;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #b7598d;
    }
    .idioma-select {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1 id="titulo">Agendar cita</h1>

  <div id="infoDiseno">Cargando dise침o seleccionado...</div>

  <label for="fecha" id="labelFecha">Selecciona fecha:</label>
  <select id="fecha"></select>

  <label for="hora" id="labelHora">Selecciona hora:</label>
  <select id="hora"></select>

  <button id="btnRegistrar">Registrar cita</button>

  <div class="idioma-select">
    <label for="idioma">游깷 Cambiar idioma:</label>
    <select id="idioma">
      <option value="es">Espa침ol latino</option>
      <option value="en">English</option>
    </select>
  </div>

  <script>
    // Mostrar dise침o y duraci칩n
    function mostrarDiseno() {
      const diseno = localStorage.getItem('disenoSeleccionado') || 'Sin dise침o';
      const duracion = localStorage.getItem('duracion') || '60';
      const idioma = localStorage.getItem('idioma') || 'es';

      const textos = {
        es: `Dise침o: ${diseno} (Duraci칩n: ${duracion} minutos)`,
        en: `Design: ${diseno} (Duration: ${duracion} minutes)`
      };
      document.getElementById('infoDiseno').innerText = textos[idioma];
    }

    // Cargar fechas pr칩ximas 14 d칤as
    function cargarFechas() {
      const selectFecha = document.getElementById('fecha');
      const hoy = new Date();
      selectFecha.innerHTML = '';
      for (let i = 0; i < 14; i++) {
        const dia = new Date(hoy);
        dia.setDate(hoy.getDate() + i);
        const opcion = document.createElement('option');
        opcion.value = dia.toISOString().slice(0,10);
        opcion.textContent = dia.toLocaleDateString('es-MX', {
          weekday: 'long',
          day: 'numeric',
          month: 'short'
        });
        selectFecha.appendChild(opcion);
      }
      selectFecha.value = new Date().toISOString().slice(0,10);
    }

    // Cargar horas de 10 a 18
    function cargarHoras() {
      const selectHora = document.getElementById('hora');
      selectHora.innerHTML = '';
      for (let h = 10; h <= 18; h++) {
        const horaStr = h.toString().padStart(2,'0') + ':00';
        const opcion = document.createElement('option');
        opcion.value = horaStr;
        opcion.textContent = horaStr;
        selectHora.appendChild(opcion);
      }
    }

    // Bloquear horas ocupadas y mostrar en gris
    function bloquearHorasOcupadas() {
      const citas = JSON.parse(localStorage.getItem("citas")) || [];
      const fechaSeleccionada = document.getElementById("fecha").value;
      const duracionNueva = parseInt(localStorage.getItem("duracion")) || 60;

      const selectHora = document.getElementById("hora");
      selectHora.innerHTML = "";

      for (let h = 10; h <= 18; h++) {
        const horaStr = h.toString().padStart(2, '0') + ":00";

        let ocupada = false;

        for (const cita of citas) {
          if (cita.fecha === fechaSeleccionada) {
            const horaCita = parseInt(cita.hora.split(":")[0]);
            const duracionCita = parseInt(cita.duracion);

            const inicio = horaCita;
            const fin = horaCita + Math.ceil(duracionCita / 60);
            const nuevaFin = h + Math.ceil(duracionNueva / 60);

            if ((h >= inicio && h < fin) || (inicio >= h && inicio < nuevaFin)) {
              ocupada = true;
              break;
            }
          }
        }

        const opcion = document.createElement("option");
        opcion.value = horaStr;
        opcion.textContent = horaStr;

        if (ocupada) {
          opcion.disabled = true;
          opcion.style.color = "gray";
          opcion.style.backgroundColor = "#eee";
        } else {
          opcion.style.color = "green";
        }

        selectHora.appendChild(opcion);
      }
    }

    // Cambiar idioma din치micamente
    function aplicarIdioma() {
      const idioma = localStorage.getItem('idioma') || 'es';

      const textos = {
        es: {
          titulo: 'Agendar cita',
          labelFecha: 'Selecciona fecha:',
          labelHora: 'Selecciona hora:',
          btnRegistrar: 'Registrar cita',
          avisoSeleccion: 'Por favor selecciona fecha y hora.',
          registroExito: 'Cita registrada con 칠xito.',
          alertaNombre: 'Por favor ingresa tu nombre y apellido.',
          formularioTitulo: 'Formulario de registro',
          campoNombre: 'Nombre',
          campoApellido: 'Apellido',
          campoPago: 'M칠todo de pago',
          btnConfirmar: 'Confirmar cita',
          mensajeError: 'Completa todos los campos obligatorios.'
        },
        en: {
          titulo: 'Schedule Appointment',
          labelFecha: 'Select date:',
          labelHora: 'Select time:',
          btnRegistrar: 'Register appointment',
          avisoSeleccion: 'Please select date and time.',
          registroExito: 'Appointment successfully registered.',
          alertaNombre: 'Please enter your first and last name.',
          formularioTitulo: 'Registration form',
          campoNombre: 'First Name',
          campoApellido: 'Last Name',
          campoPago: 'Payment method',
          btnConfirmar: 'Confirm appointment',
          mensajeError: 'Please fill in all required fields.'
        }
      };

      const t = textos[idioma];

      document.getElementById('titulo').innerText = t.titulo;
      document.getElementById('labelFecha').innerText = t.labelFecha;
      document.getElementById('labelHora').innerText = t.labelHora;
      document.getElementById('btnRegistrar').innerText = t.btnRegistrar;
    }

    // Guardar idioma cuando cambia selector
    document.getElementById('idioma').addEventListener('change', (e) => {
      localStorage.setItem('idioma', e.target.value);
      aplicarIdioma();
      mostrarDiseno();
    });

    // Registrar cita (pasa a formulario)
    document.getElementById('btnRegistrar').addEventListener('click', () => {
      const fecha = document.getElementById('fecha').value;
      const hora = document.getElementById('hora').value;
      const idioma = localStorage.getItem('idioma') || 'es';

      const textos = {
        es: 'Por favor selecciona fecha y hora.',
        en: 'Please select date and time.'
      };

      if (!fecha || !hora) {
        alert(textos[idioma]);
        return;
      }

      // Guardamos fecha y hora seleccionadas para usar en el formulario
      localStorage.setItem('fechaSeleccionada', fecha);
      localStorage.setItem('horaSeleccionada', hora);

      // Ir al formulario de registro (registro.html)
      window.location.href = 'registro.html';
    });

    // Cuando cambia la fecha, actualizar horarios
    document.getElementById('fecha').addEventListener('change', bloquearHorasOcupadas);

    // Inicializar todo
    function init() {
      if (!localStorage.getItem('idioma')) {
        localStorage.setItem('idioma', 'es');
      }
      aplicarIdioma();
      mostrarDiseno();
      cargarFechas();
      cargarHoras();
      bloquearHorasOcupadas();
    }

    init();
  </script>
</body>
</html>
