<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Título</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #fff0f5;
      text-align: center;
      padding: 20px;
    }
    h1 {
      color: #d36ba0;
      margin-bottom: 30px;
    }
    button {
      font-size: 18px;
      padding: 15px 30px;
      margin: 10px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      background-color: #d36ba0;
      color: white;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #b7598d;
    }
    #seccionCancelar {
      margin-top: 20px;
      border: 2px solid #d36ba0;
      border-radius: 12px;
      padding: 20px;
      max-width: 350px;
      margin-left: auto;
      margin-right: auto;
      display: none;
      background-color: #fff;
    }
    #seccionCancelar p {
      font-size: 16px;
      margin-bottom: 15px;
    }
    #seccionCancelar button {
      width: 45%;
      margin: 5px 2%;
    }
    #seccionCancelar button#confirmarCancelacionIndex {
      background-color: #b03050;
    }
  </style>
</head>
<body>
  <h1>Título</h1>

  <button id="btnCatalogo">Catálogo de diseños</button>
  <button id="btnAgendar">Agendar cita</button>
  <button id="btnCancelarCitaIndex" style="background-color:#b03050;">Cancelar mi cita</button>

  <div id="seccionCancelar">
    <p id="detalleCitaIndex"></p>
    <button id="confirmarCancelacionIndex">Confirmar cancelación</button>
    <button id="cerrarCancelacionIndex">Cancelar</button>
  </div>

  <script>
    const telefonoDueña = '521XXXXXXXXXX'; // Cambia aquí al número real sin signos ni espacios

    // Botones principales
    document.getElementById('btnCatalogo').addEventListener('click', () => {
      window.location.href = 'catalogo.html';
    });

    document.getElementById('btnAgendar').addEventListener('click', () => {
      alert('Para agendar primero selecciona en catálogo para escoger un estilo y posteriormente selecciona "agendar"');
    });

    // Cancelar cita botón y sección
    const btnCancelar = document.getElementById('btnCancelarCitaIndex');
    const seccionCancelar = document.getElementById('seccionCancelar');
    const detalleCitaIndex = document.getElementById('detalleCitaIndex');
    const confirmarCancelacionIndex = document.getElementById('confirmarCancelacionIndex');
    const cerrarCancelacionIndex = document.getElementById('cerrarCancelacionIndex');

    btnCancelar.addEventListener('click', () => {
      const cita = {
        fecha: localStorage.getItem('fechaSeleccionada'),
        hora: localStorage.getItem('horaSeleccionada'),
        nombre: localStorage.getItem('nombreCliente') || 'Cliente',
        diseno: localStorage.getItem('disenoSeleccionado') || 'Diseño desconocido'
      };

      if (!cita.fecha || !cita.hora) {
        alert('No tienes cita agendada.');
        return;
      }

      detalleCitaIndex.textContent = `Tu cita: ${cita.diseno}, ${cita.fecha} a las ${cita.hora}`;
      seccionCancelar.style.display = 'block';
    });

    confirmarCancelacionIndex.addEventListener('click', () => {
      const cita = {
        fecha: localStorage.getItem('fechaSeleccionada'),
        hora: localStorage.getItem('horaSeleccionada'),
        nombre: localStorage.getItem('nombreCliente') || 'Cliente',
        diseno: localStorage.getItem('disenoSeleccionado') || 'Diseño desconocido'
      };

      const hoy = new Date();
      const fechaCita = new Date(cita.fecha);
      const diffDias = (fechaCita - hoy) / (1000 * 60 * 60 * 24);

      if (diffDias < 2) {
        alert('Solo puedes cancelar con al menos 2 días de anticipación.');
        return;
      }

      let citas = JSON.parse(localStorage.getItem('citas')) || [];

      citas = citas.filter(c => !(c.fecha === cita.fecha && c.hora === cita.hora && c.nombre === cita.nombre));

      localStorage.setItem('citas', JSON.stringify(citas));

      const mensaje = encodeURIComponent(
        `La cita de ${cita.nombre} para ${cita.diseno} el día ${cita.fecha} a las ${cita.hora} ha sido CANCELADA.`
      );
      window.open(`https://wa.me/${telefonoDueña}?text=${mensaje}`, '_blank');

      localStorage.removeItem('fechaSeleccionada');
      localStorage.removeItem('horaSeleccionada');
      localStorage.removeItem('nombreCliente');
      localStorage.removeItem('disenoSeleccionado');
      localStorage.removeItem('duracion');

      alert('Cita cancelada con éxito.');

      seccionCancelar.style.display = 'none';

      location.reload();
    });

    cerrarCancelacionIndex.addEventListener('click', () => {
      seccionCancelar.style.display = 'none';
    });
  </script>
</body>
</html>
